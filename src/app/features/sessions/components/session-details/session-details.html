<article class="session-detail">
  <!-- Loading State -->
  @if (loading()) {
    <div class="session-detail__loading">
      <div class="loading-spinner"></div>
      <p>Loading session notes...</p>
    </div>
  }

    <!-- Error State -->
  @if (error()) {
    <div class="session-detail__error">
      <span class="error-icon material-symbols-outlined" aria-hidden="true">warning</span>
      <h1>Unable to Load Session</h1>
      <p>{{ error() }}</p>
      <a routerLink="/sessions" class="btn btn--primary">
        <span class="material-symbols-outlined" aria-hidden="true">arrow_back</span>
        <span>Back to Sessions</span>
      </a>
    </div>
  }


  <!-- Session Content -->
  @if (!loading() && !error() && session(); as s) {
    <!-- Hero Header -->
    <header class="session-hero">
      <div class="session-hero__backdrop"></div>
      <div class="session-hero__content">
        <nav class="session-hero__breadcrumb">
          <a routerLink="/sessions" class="breadcrumb-link">Sessions</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">{{ sessionTitle() }}</span>
        </nav>

        <div class="session-hero__number">
          @if (s.sessionNumber === 0) {
            <span>Session Zero</span>
          } @else {
            <span>Session {{ s.sessionNumber }}</span>
          }
        </div>

        <h1 class="session-hero__title">{{ sessionTitle() }}</h1>

        <div class="session-hero__meta">
          <time class="meta-item" [attr.datetime]="s.sessionDate">
            <span class="meta-icon material-symbols-outlined" aria-hidden="true">calendar_month</span>
            {{ s.computed.formattedDate }}
          </time>
          
          <span class="meta-item">
            <span class="meta-icon material-symbols-outlined" aria-hidden="true">auto_awesome</span>
            +{{ s.experienceGained }} XP
          </span>

          @if (s.computed.wordCount > 0) {
            <span class="meta-item">
              <span class="meta-icon material-symbols-outlined" aria-hidden="true">description</span>
              {{ s.computed.wordCount }} words
            </span>
          }
        </div>


        <!-- Players -->
        @if (s.players.length > 0) {
          <div class="session-hero__players">
            <span class="players-label">Adventurers:</span>
            <div class="player-avatars">
              @for (player of s.players; track trackByPlayerId($index, player)) {
                <a 
                  [routerLink]="['/characters', player.id]"
                  class="player-avatar"
                  [attr.title]="player.name"
                  [attr.aria-label]="'View ' + player.name + ' character sheet'"
                >
                  <span class="player-avatar__initials">{{ getPlayerInitials(player) }}</span>
                </a>
              }
            </div>
            <span class="players-names">
              @for (player of s.players; track player.id; let last = $last) {
                <a [routerLink]="['/characters', player.id]" class="player-name">
                  {{ player.name }}
                </a>{{ last ? '' : ', ' }}
              }
            </span>
          </div>
        }
      </div>
    </header>

    <!-- Session Narrative -->
    <div class="session-narrative">
      <!-- Preface Section -->
      @if (s.sessionNotesPreface) {
        <section class="narrative-section narrative-section--preface">
          <h2 class="narrative-section__title">Session Preface</h2>
          <p class="narrative-section__text">
            {{ s.sessionNotesPreface }}
          </p>
        </section>
      }

      <!-- Divider -->
      @if (s.sessionNotesPreface && s.sessionNotesCombat) {
        <div class="narrative-divider">
          <span class="divider-line"></span>
          <span class="divider-icon material-symbols-outlined" aria-hidden="true">sports_martial_arts</span>
          <span class="divider-line"></span>
        </div>
      }

      <!-- Combat Section -->
      @if (s.sessionNotesCombat) {
        <section class="narrative-section narrative-section--combat">
          <h2 class="narrative-section__title">Session Conflict</h2>
          <p class="narrative-section__text">
            {{ s.sessionNotesCombat }}
          </p>
        </section>
      }

      <!-- Divider -->
      @if (s.sessionNotesPreface && s.sessionNotesCombat) {
        <div class="narrative-divider">
          <span class="divider-line"></span>
          <span class="divider-icon material-symbols-outlined" aria-hidden="true">sports_martial_arts</span>
          <span class="divider-line"></span>
        </div>
      }

      <!-- End Section -->
      @if (s.sessionNotesEnd) {
        <section class="narrative-section narrative-section--end">
          <h2 class="narrative-section__title">Session Closing</h2>
          <p class="narrative-section__text">
            {{ s.sessionNotesEnd }}
          </p>
        </section>
      }

      <!-- Empty State if no content -->
      @if (!s.sessionNotesPreface && !s.sessionNotesCombat && !s.sessionNotesEnd) {
        <div class="narrative-empty">
          <span class="empty-icon">ðŸ“œ</span>
          <p>The chronicles of this session have yet to be written...</p>
        </div>
      }
    </div>

        <!-- Session Footer with Navigation -->
    <footer class="session-footer">
      <div class="session-footer__nav">
        @if (previousSessionId()) {
          <a 
            [routerLink]="['/sessions', previousSessionId()]" 
            class="nav-link nav-link--prev"
          >
            <span class="nav-link__arrow material-symbols-outlined" aria-hidden="true">chevron_left</span>
            <span class="nav-link__text">Previous Session</span>
          </a>
        } @else {
          <span class="nav-link nav-link--disabled">
            <span class="nav-link__arrow material-symbols-outlined" aria-hidden="true">chevron_left</span>
            <span class="nav-link__text">Previous Session</span>
          </span>
        }

        <span class="nav-link nav-link--all">
          <a routerLink="/sessions">
            <span class="nav-link__text">All Sessions</span>
          </a>
        </span>

        @if (nextSessionId()) {
          <a 
            [routerLink]="['/sessions', nextSessionId()]" 
            class="nav-link nav-link--next"
          >
            <span class="nav-link__text">Next Session</span>
            <span class="nav-link__arrow material-symbols-outlined" aria-hidden="true">chevron_right</span>
          </a>
        } @else {
          <span class="nav-link nav-link--disabled">
            <span class="nav-link__text">Next Session</span>
            <span class="nav-link__arrow material-symbols-outlined" aria-hidden="true">chevron_right</span>
          </span>
        }
      </div>

      <!-- XP Reward Banner -->
      <div class="session-footer__xp">
        <div class="xp-reward">
          <span class="xp-reward__label">Session Reward</span>
          <span class="xp-reward__value">+{{ s.experienceGained }} XP</span>
        </div>
      </div>
    </footer>
  }
</article>
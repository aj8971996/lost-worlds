<!-- ═══════════════════════════════════════════════════════════════════════════
     INITIATIVE LIST COMPONENT
     Track turn order during combat encounters
     ═══════════════════════════════════════════════════════════════════════════ -->
<section class="initiative-tracker panel">
  <!-- Panel Header -->
  <header class="initiative-tracker__header">
    <div class="initiative-tracker__title-row">
      <h2 class="panel__title">
        <span class="material-symbols-outlined">format_list_numbered</span>
        Initiative
      </h2>
      @if (combatState().isActive) {
        <span class="round-badge">Round {{ combatState().round }}</span>
      }
    </div>
    
    <!-- Combat Controls -->
    <div class="combat-controls">
      @if (!combatState().isActive) {
        <button 
          type="button"
          class="btn btn--primary"
          [disabled]="combatState().initiative.length === 0"
          (click)="startCombat()"
        >
          <span class="material-symbols-outlined">play_arrow</span>
          Start Combat
        </button>
      } @else {
        <button 
          type="button"
          class="btn btn--ghost"
          (click)="previousTurn()"
          aria-label="Previous turn"
        >
          <span class="material-symbols-outlined">skip_previous</span>
        </button>
        <button 
          type="button"
          class="btn btn--primary"
          (click)="nextTurn()"
        >
          <span class="material-symbols-outlined">skip_next</span>
          Next
        </button>
        <button 
          type="button"
          class="btn btn--ghost btn--danger"
          (click)="endCombat()"
          aria-label="End combat"
        >
          <span class="material-symbols-outlined">stop</span>
        </button>
      }
    </div>
  </header>

  <!-- Current Turn Banner -->
  @if (combatState().isActive && currentTurnEntry(); as current) {
    <div class="current-turn">
      <span class="current-turn__label">Current Turn</span>
      <span class="current-turn__name">{{ current.name }}</span>
      <span class="current-turn__initiative">{{ current.initiative }}</span>
    </div>
  }

  <!-- Initiative List -->
  <div class="initiative-list">
    @if (sortedInitiative().length === 0) {
      <div class="empty-state">
        <span class="material-symbols-outlined">group_add</span>
        <p>No combatants added</p>
        <p class="empty-state__hint">Add characters or NPCs below</p>
      </div>
    } @else {
      @for (entry of sortedInitiative(); track entry.id) {
        <div 
          class="initiative-entry"
          [class.initiative-entry--active]="entry.isCurrentTurn"
          [class.initiative-entry--player]="entry.isPlayer"
          [class.initiative-entry--npc]="!entry.isPlayer"
        >
          <!-- Turn Indicator -->
          <div class="initiative-entry__indicator">
            @if (entry.isCurrentTurn) {
              <span class="material-symbols-outlined initiative-entry__marker">arrow_right</span>
            }
          </div>
          
          <!-- Type Icon -->
          <span class="initiative-entry__icon material-symbols-outlined">
            {{ getEntryIcon(entry) }}
          </span>
          
          <!-- Info -->
          <div class="initiative-entry__info">
            <span class="initiative-entry__name">{{ entry.name }}</span>
            @if (entry.notes) {
              <span class="initiative-entry__notes">{{ entry.notes }}</span>
            }
          </div>
          
          <!-- Initiative Value -->
          <span class="initiative-entry__value">{{ entry.initiative }}</span>
          
          <!-- Remove Button -->
          <button 
            type="button"
            class="initiative-entry__remove"
            (click)="removeEntry(entry.id)"
            aria-label="Remove {{ entry.name }} from initiative"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
      }
    }
  </div>

  <!-- Add Entry Section -->
  <div class="add-section">
    @if (!showAddForm()) {
      <div class="add-section__buttons">
        <button 
          type="button"
          class="btn btn--secondary"
          (click)="toggleAddForm()"
        >
          <span class="material-symbols-outlined">person_add</span>
          Add Character
        </button>
        <button 
          type="button"
          class="btn btn--ghost"
          (click)="addQuickNpc()"
        >
          <span class="material-symbols-outlined">smart_toy</span>
          Quick NPC
        </button>
      </div>
    } @else {
      <div class="add-form">
        <h3 class="add-form__title">Add to Initiative</h3>
        
        <!-- Character Selection -->
        <div class="form-group">
          <label class="form-label">Select Character (Optional)</label>
          <select 
            class="form-select"
            (change)="onCharacterSelect($event)"
          >
            <option value="">— Manual Entry —</option>
            @for (char of characters(); track char.id) {
              <option [value]="char.id">{{ char.name }}</option>
            }
          </select>
        </div>

        <!-- Name Input -->
        <div class="form-group">
          <label class="form-label">Name</label>
          <input 
            type="text"
            class="form-input"
            [value]="newEntryName()"
            (input)="newEntryName.set($any($event.target).value)"
            placeholder="Enter name..."
          />
        </div>

        <!-- Initiative Input Row -->
        <div class="form-row">
          <div class="form-group form-group--flex">
            <label class="form-label">Initiative</label>
            <input 
              type="number"
              class="form-input"
              [value]="newEntryInitiative()"
              (input)="newEntryInitiative.set(+$any($event.target).value)"
              placeholder="0"
            />
          </div>
          
          @if (selectedCharacterId()) {
            <button 
              type="button"
              class="btn btn--secondary add-form__roll-btn"
              (click)="rollInitiativeForCharacter()"
            >
              <span class="material-symbols-outlined">casino</span>
              Roll
            </button>
          }
        </div>

        <!-- Is Player Toggle -->
        <div class="form-group">
          <label class="toggle">
            <input 
              type="checkbox"
              class="toggle__input"
              [checked]="newEntryIsPlayer()"
              (change)="newEntryIsPlayer.set($any($event.target).checked)"
            />
            <span class="toggle__label">Is Player Character</span>
          </label>
        </div>

        <!-- Form Actions -->
        <div class="add-form__actions">
          <button 
            type="button"
            class="btn btn--ghost"
            (click)="toggleAddForm()"
          >Cancel</button>
          <button 
            type="button"
            class="btn btn--primary"
            [disabled]="!newEntryName() || newEntryInitiative() === null"
            (click)="addEntry()"
          >Add to Initiative</button>
        </div>
      </div>
    }
  </div>
</section>